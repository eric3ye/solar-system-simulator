<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太阳系模拟器 - 探索宇宙的奥秘</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Arial', sans-serif;
        }
        
        #canvas {
            display: block;
            cursor: grab;
        }
        
        #canvas:active {
            cursor: grabbing;
        }
        
        .control-panel {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }
        
        .control-panel.collapsed {
            transform: translateX(-100%);
        }
        
        .toggle-panel {
            position: absolute;
            right: -40px;
            top: 20px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: none;
            border-radius: 0 8px 8px 0;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-panel:hover {
            background: rgba(30, 41, 59, 0.95);
        }
        
        .planet-info {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .slider {
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            border-radius: 5px;
        }
        
        .slider:hover {
            opacity: 1;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        
        .slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        
        .custom-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .custom-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-primary {
            background: #3b82f6;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: #6b7280;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }
        
        .btn-danger {
            background: #ef4444;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- 加载画面 -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="text-2xl mb-2">正在初始化太阳系...</h2>
            <p class="text-gray-400">准备探索宇宙的奥秘</p>
        </div>
    </div>

    <!-- 主画布 -->
    <canvas id="canvas"></canvas>

    <!-- 控制面板 -->
    <div id="controlPanel" class="control-panel fixed left-0 top-0 h-full w-80 p-6 overflow-y-auto z-50">
        <div class="toggle-panel" onclick="togglePanel()">
            <i class="fas fa-chevron-left" id="toggleIcon"></i>
        </div>
        
        <h1 class="text-2xl font-bold mb-6 text-white">
            <i class="fas fa-globe-americas mr-2"></i>太阳系模拟器
        </h1>
        
        <!-- 基本控制 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">基本控制</h3>
            <div class="space-y-3">
                <button id="playPause" class="btn-primary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-pause mr-2"></i>暂停
                </button>
                <button id="resetView" class="btn-secondary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-home mr-2"></i>重置视图
                </button>
                <button id="resetSystem" class="btn-secondary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-redo mr-2"></i>重置系统
                </button>
            </div>
        </div>
        
        <!-- 视图选项 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">视图选项</h3>
            <div class="space-y-3">
                <label class="flex items-center text-white">
                    <input type="checkbox" id="showOrbits" checked class="mr-2">
                    <span>显示轨道</span>
                </label>
                <label class="flex items-center text-white">
                    <input type="checkbox" id="showLabels" checked class="mr-2">
                    <span>显示标签</span>
                </label>
                <label class="flex items-center text-white">
                    <input type="checkbox" id="showStars" checked class="mr-2">
                    <span>显示星空背景</span>
                </label>
                <label class="flex items-center text-white">
                    <input type="checkbox" id="showTrails" class="mr-2">
                    <span>显示轨迹</span>
                </label>
            </div>
        </div>
        
        <!-- 速度控制 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">时间速度</h3>
            <div class="space-y-2">
                <input type="range" id="speedSlider" class="slider w-full h-2" min="0" max="10" value="1" step="0.1">
                <div class="flex justify-between text-sm text-gray-400">
                    <span>0x</span>
                    <span id="speedValue">1x</span>
                    <span>10x</span>
                </div>
            </div>
        </div>
        
        <!-- 缩放控制 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">缩放级别</h3>
            <div class="space-y-2">
                <input type="range" id="zoomSlider" class="slider w-full h-2" min="0.1" max="5" value="1" step="0.1">
                <div class="flex justify-between text-sm text-gray-400">
                    <span>10%</span>
                    <span id="zoomValue">100%</span>
                    <span>500%</span>
                </div>
            </div>
        </div>
        
        <!-- 沙盒模式 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">沙盒模式</h3>
            <div class="space-y-3">
                <button id="sandboxMode" class="btn-primary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-cube mr-2"></i>启用沙盒模式
                </button>
                <div id="sandboxControls" class="hidden space-y-3">
                    <button id="addPlanet" class="btn-secondary w-full py-2 px-4 rounded text-white">
                        <i class="fas fa-plus-circle mr-2"></i>添加行星
                    </button>
                    <button id="addAsteroid" class="btn-secondary w-full py-2 px-4 rounded text-white">
                        <i class="fas fa-meteor mr-2"></i>添加小行星
                    </button>
                    <button id="addComet" class="btn-secondary w-full py-2 px-4 rounded text-white">
                        <i class="fas fa-star mr-2"></i>添加彗星
                    </button>
                    <label class="flex items-center text-white">
                        <input type="checkbox" id="gravityInteraction" class="mr-2">
                        <span>引力相互作用</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- 预设系统 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3 text-white">预设系统</h3>
            <div class="space-y-3">
                <button id="loadBinary" class="btn-secondary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-star mr-2"></i>双星系统
                </button>
                <button id="loadAsteroidBelt" class="btn-secondary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-circle-notch mr-2"></i>小行星带
                </button>
                <button id="saveSystem" class="btn-secondary w-full py-2 px-4 rounded text-white">
                    <i class="fas fa-save mr-2"></i>保存当前系统
                </button>
            </div>
        </div>
        
        <!-- 关于 -->
        <div class="mt-8 pt-6 border-t border-gray-700">
            <p class="text-sm text-gray-400">
                <i class="fas fa-info-circle mr-1"></i>
                使用鼠标拖动旋转视角，滚轮缩放
            </p>
        </div>
    </div>
    
    <!-- 行星信息面板 -->
    <div id="planetInfo" class="planet-info fixed right-6 top-6 w-80 p-6 hidden">
        <h2 id="planetName" class="text-xl font-bold mb-4 text-white"></h2>
        <div id="planetDetails" class="space-y-2 text-sm text-gray-300"></div>
        <div id="editControls" class="mt-4 space-y-3 hidden">
            <h3 class="text-lg font-semibold text-white">编辑参数</h3>
            <div class="space-y-2">
                <div>
                    <label class="text-sm text-gray-400">质量</label>
                    <input type="number" id="editMass" class="custom-input w-full">
                </div>
                <div>
                    <label class="text-sm text-gray-400">轨道半径</label>
                    <input type="number" id="editRadius" class="custom-input w-full">
                </div>
                <div>
                    <label class="text-sm text-gray-400">轨道速度</label>
                    <input type="number" id="editSpeed" class="custom-input w-full">
                </div>
                <div class="flex space-x-2">
                    <button id="saveEdit" class="btn-primary flex-1 py-2 px-4 rounded text-white">
                        保存
                    </button>
                    <button id="deletePlanet" class="btn-danger flex-1 py-2 px-4 rounded text-white">
                        删除
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 通知 -->
    <div id="notification" class="notification">
        <p id="notificationText"></p>
    </div>

    <script>
        // 全局变量
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let centerX, centerY;
        let scale = 1;
        let rotation = 0;
        let isPaused = false;
        let speedMultiplier = 1;
        let showOrbits = true;
        let showLabels = true;
        let showStars = true;
        let showTrails = false;
        let sandboxMode = false;
        let gravityInteraction = false;
        let selectedPlanet = null;
        let mouseDown = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let stars = [];
        let trails = [];
        
        // 天体数据
        const sun = {
            name: '太阳',
            radius: 30,
            color: '#FDB813',
            mass: 1989000,
            x: 0,
            y: 0,
            rotation: 0,
            rotationSpeed: 0.001
        };
        
        let planets = [
            {
                name: '水星',
                radius: 4,
                color: '#8C7853',
                mass: 0.33,
                orbitRadius: 60,
                orbitSpeed: 0.04,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.002,
                type: 'planet'
            },
            {
                name: '金星',
                radius: 8,
                color: '#FFC649',
                mass: 4.87,
                orbitRadius: 90,
                orbitSpeed: 0.015,
                angle: 0,
                rotation: 0,
                rotationSpeed: -0.001,
                type: 'planet'
            },
            {
                name: '地球',
                radius: 8,
                color: '#4169E1',
                mass: 5.97,
                orbitRadius: 120,
                orbitSpeed: 0.01,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.01,
                type: 'planet',
                moons: [{
                    name: '月球',
                    radius: 2,
                    color: '#C0C0C0',
                    orbitRadius: 15,
                    orbitSpeed: 0.1,
                    angle: 0
                }]
            },
            {
                name: '火星',
                radius: 5,
                color: '#CD5C5C',
                mass: 0.642,
                orbitRadius: 150,
                orbitSpeed: 0.008,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.009,
                type: 'planet'
            },
            {
                name: '木星',
                radius: 20,
                color: '#DAA520',
                mass: 1898,
                orbitRadius: 250,
                orbitSpeed: 0.002,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.02,
                type: 'planet'
            },
            {
                name: '土星',
                radius: 17,
                color: '#F4A460',
                mass: 568,
                orbitRadius: 350,
                orbitSpeed: 0.0009,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.018,
                type: 'planet',
                hasRing: true
            },
            {
                name: '天王星',
                radius: 12,
                color: '#4FD0E0',
                mass: 86.8,
                orbitRadius: 450,
                orbitSpeed: 0.0004,
                angle: 0,
                rotation: 0,
                rotationSpeed: -0.012,
                type: 'planet'
            },
            {
                name: '海王星',
                radius: 11,
                color: '#4169E1',
                mass: 102,
                orbitRadius: 550,
                orbitSpeed: 0.0001,
                angle: 0,
                rotation: 0,
                rotationSpeed: 0.011,
                type: 'planet'
            }
        ];
        
        // 初始化画布
        function initCanvas() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            centerX = width / 2;
            centerY = height / 2;
            
            // 创建星空背景
            createStars();
        }
        
        // 创建星空背景
        function createStars() {
            stars = [];
            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: Math.random() * 2,
                    brightness: Math.random()
                });
            }
        }
        
        // 绘制星空背景
        function drawStars() {
            if (!showStars) return;
            
            ctx.save();
            stars.forEach(star => {
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.restore();
        }
        
        // 绘制太阳
        function drawSun() {
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation);
            
            // 太阳光晕
            const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, sun.radius * 2);
            gradient.addColorStop(0, 'rgba(253, 184, 19, 0.8)');
            gradient.addColorStop(0.5, 'rgba(253, 184, 19, 0.3)');
            gradient.addColorStop(1, 'rgba(253, 184, 19, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(0, 0, sun.radius * 2, 0, Math.PI * 2);
            ctx.fill();
            
            // 太阳本体
            ctx.fillStyle = sun.color;
            ctx.beginPath();
            ctx.arc(0, 0, sun.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // 太阳表面纹理
            ctx.strokeStyle = 'rgba(255, 200, 0, 0.3)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.arc(0, 0, sun.radius - i * 5, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            ctx.restore();
        }
        
        // 绘制轨道
        function drawOrbit(planet) {
            if (!showOrbits) return;
            
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(rotation);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.arc(0, 0, planet.orbitRadius * scale, 0, Math.PI * 2);
            ctx.stroke();
            ctx.restore();
        }
        
        // 绘制行星
        function drawPlanet(planet) {
            const x = centerX + Math.cos(planet.angle) * planet.orbitRadius * scale;
            const y = centerY + Math.sin(planet.angle) * planet.orbitRadius * scale;
            
            // 更新位置
            planet.x = x - centerX;
            planet.y = y - centerY;
            
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(planet.rotation);
            
            // 行星阴影
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 5;
            ctx.shadowOffsetY = 5;
            
            // 行星本体
            ctx.fillStyle = planet.color;
            ctx.beginPath();
            ctx.arc(0, 0, planet.radius * scale, 0, Math.PI * 2);
            ctx.fill();
            
            // 土星环
            if (planet.hasRing) {
                ctx.strokeStyle = 'rgba(244, 164, 96, 0.6)';
                ctx.lineWidth = 3 * scale;
                ctx.beginPath();
                ctx.ellipse(0, 0, planet.radius * scale * 1.8, planet.radius * scale * 0.8, 0, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            ctx.restore();
            
            // 绘制卫星
            if (planet.moons) {
                planet.moons.forEach(moon => {
                    const moonX = x + Math.cos(moon.angle) * moon.orbitRadius * scale;
                    const moonY = y + Math.sin(moon.angle) * moon.orbitRadius * scale;
                    
                    ctx.fillStyle = moon.color;
                    ctx.beginPath();
                    ctx.arc(moonX, moonY, moon.radius * scale, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            
            // 绘制标签
            if (showLabels) {
                ctx.fillStyle = 'white';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(planet.name, x, y + planet.radius * scale + 15);
            }
            
            // 绘制轨迹
            if (showTrails) {
                if (!planet.trail) planet.trail = [];
                planet.trail.push({ x, y });
                if (planet.trail.length > 100) planet.trail.shift();
                
                ctx.strokeStyle = planet.color + '40';
                ctx.lineWidth = 2;
                ctx.beginPath();
                planet.trail.forEach((point, index) => {
                    if (index === 0) {
                        ctx.moveTo(point.x, point.y);
                    } else {
                        ctx.lineTo(point.x, point.y);
                    }
                });
                ctx.stroke();
            }
        }
        
        // 更新行星位置
        function updatePlanets() {
            if (isPaused) return;
            
            // 更新太阳自转
            sun.rotation += sun.rotationSpeed * speedMultiplier;
            
            planets.forEach(planet => {
                // 更新轨道位置
                planet.angle += planet.orbitSpeed * speedMultiplier;
                
                // 更新自转
                planet.rotation += planet.rotationSpeed * speedMultiplier;
                
                // 更新卫星
                if (planet.moons) {
                    planet.moons.forEach(moon => {
                        moon.angle += moon.orbitSpeed * speedMultiplier;
                    });
                }
            });
            
            // 引力相互作用
            if (gravityInteraction && sandboxMode) {
                applyGravity();
            }
        }
        
        // 应用引力
        function applyGravity() {
            const G = 0.1; // 引力常数
            
            for (let i = 0; i < planets.length; i++) {
                for (let j = i + 1; j < planets.length; j++) {
                    const p1 = planets[i];
                    const p2 = planets[j];
                    
                    const dx = p2.x - p1.x;
                    const dy = p2.y - p1.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 0) {
                        const force = G * p1.mass * p2.mass / (distance * distance);
                        const fx = force * dx / distance;
                        const fy = force * dy / distance;
                        
                        // 简化的引力影响
                        p1.orbitSpeed += fx / p1.mass * 0.0001;
                        p2.orbitSpeed -= fx / p2.mass * 0.0001;
                    }
                }
            }
        }
        
        // 主渲染循环
        function render() {
            ctx.clearRect(0, 0, width, height);
            
            // 绘制星空背景
            drawStars();
            
            // 绘制轨道
            planets.forEach(planet => drawOrbit(planet));
            
            // 绘制太阳
            drawSun();
            
            // 绘制行星
            planets.forEach(planet => drawPlanet(planet));
            
            // 更新位置
            updatePlanets();
            
            requestAnimationFrame(render);
        }
        
        // 鼠标事件处理
        canvas.addEventListener('mousedown', (e) => {
            mouseDown = true;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            
            // 检查是否点击了行星
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left - centerX;
            const y = e.clientY - rect.top - centerY;
            
            selectedPlanet = null;
            planets.forEach(planet => {
                const distance = Math.sqrt(
                    Math.pow(x - planet.x, 2) + 
                    Math.pow(y - planet.y, 2)
                );
                if (distance < planet.radius * scale) {
                    selectedPlanet = planet;
                    showPlanetInfo(planet);
                }
            });
            
            if (!selectedPlanet) {
                hidePlanetInfo();
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (!mouseDown) return;
            
            const deltaX = e.clientX - lastMouseX;
            const deltaY = e.clientY - lastMouseY;
            
            rotation += deltaX * 0.01;
            
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
        });
        
        canvas.addEventListener('mouseup', () => {
            mouseDown = false;
        });
        
        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            scale *= delta;
            scale = Math.max(0.1, Math.min(5, scale));
            document.getElementById('zoomSlider').value = scale;
            document.getElementById('zoomValue').textContent = Math.round(scale * 100) + '%';
        });
        
        // 显示行星信息
        function showPlanetInfo(planet) {
            const infoPanel = document.getElementById('planetInfo');
            const nameElement = document.getElementById('planetName');
            const detailsElement = document.getElementById('planetDetails');
            const editControls = document.getElementById('editControls');
            
            nameElement.textContent = planet.name;
            detailsElement.innerHTML = `
                <p><i class="fas fa-weight mr-2"></i>质量: ${planet.mass} × 10²⁴ kg</p>
                <p><i class="fas fa-ruler mr-2"></i>半径: ${planet.radius} px</p>
                <p><i class="fas fa-circle-notch mr-2"></i>轨道半径: ${planet.orbitRadius} px</p>
                <p><i class="fas fa-tachometer-alt mr-2"></i>轨道速度: ${planet.orbitSpeed.toFixed(4)} rad/frame</p>
                <p><i class="fas fa-sync mr-2"></i>自转速度: ${planet.rotationSpeed.toFixed(4)} rad/frame</p>
            `;
            
            if (sandboxMode) {
                editControls.classList.remove('hidden');
                document.getElementById('editMass').value = planet.mass;
                document.getElementById('editRadius').value = planet.orbitRadius;
                document.getElementById('editSpeed').value = planet.orbitSpeed;
            } else {
                editControls.classList.add('hidden');
            }
            
            infoPanel.classList.remove('hidden');
        }
        
        // 隐藏行星信息
        function hidePlanetInfo() {
            document.getElementById('planetInfo').classList.add('hidden');
        }
        
        // 控制面板切换
        function togglePanel() {
            const panel = document.getElementById('controlPanel');
            const icon = document.getElementById('toggleIcon');
            panel.classList.toggle('collapsed');
            icon.classList.toggle('fa-chevron-left');
            icon.classList.toggle('fa-chevron-right');
        }
        
        // 显示通知
        function showNotification(message) {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            text.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // 事件监听器
        document.getElementById('playPause').addEventListener('click', function() {
            isPaused = !isPaused;
            this.innerHTML = isPaused ? 
                '<i class="fas fa-play mr-2"></i>播放' : 
                '<i class="fas fa-pause mr-2"></i>暂停';
        });
        
        document.getElementById('resetView').addEventListener('click', () => {
            scale = 1;
            rotation = 0;
            document.getElementById('zoomSlider').value = 1;
            document.getElementById('zoomValue').textContent = '100%';
            showNotification('视图已重置');
        });
        
        document.getElementById('resetSystem').addEventListener('click', () => {
            if (confirm('确定要重置整个太阳系吗？')) {
                location.reload();
            }
        });
        
        document.getElementById('showOrbits').addEventListener('change', (e) => {
            showOrbits = e.target.checked;
        });
        
        document.getElementById('showLabels').addEventListener('change', (e) => {
            showLabels = e.target.checked;
        });
        
        document.getElementById('showStars').addEventListener('change', (e) => {
            showStars = e.target.checked;
        });
        
        document.getElementById('showTrails').addEventListener('change', (e) => {
            showTrails = e.target.checked;
            if (!showTrails) {
                planets.forEach(planet => planet.trail = []);
            }
        });
        
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            speedMultiplier = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = speedMultiplier.toFixed(1) + 'x';
        });
        
        document.getElementById('zoomSlider').addEventListener('input', (e) => {
            scale = parseFloat(e.target.value);
            document.getElementById('zoomValue').textContent = Math.round(scale * 100) + '%';
        });
        
        // 沙盒模式
        document.getElementById('sandboxMode').addEventListener('click', function() {
            sandboxMode = !sandboxMode;
            const controls = document.getElementById('sandboxControls');
            
            if (sandboxMode) {
                controls.classList.remove('hidden');
                this.innerHTML = '<i class="fas fa-cube mr-2"></i>关闭沙盒模式';
                this.classList.remove('btn-primary');
                this.classList.add('btn-danger');
                showNotification('沙盒模式已启用');
            } else {
                controls.classList.add('hidden');
                this.innerHTML = '<i class="fas fa-cube mr-2"></i>启用沙盒模式';
                this.classList.remove('btn-danger');
                this.classList.add('btn-primary');
                hidePlanetInfo();
                showNotification('沙盒模式已关闭');
            }
        });
        
        // 添加行星
        document.getElementById('addPlanet').addEventListener('click', () => {
            const newPlanet = {
                name: `行星 ${planets.length + 1}`,
                radius: Math.random() * 10 + 5,
                color: `hsl(${Math.random() * 360}, 70%, 50%)`,
                mass: Math.random() * 100 + 1,
                orbitRadius: Math.random() * 300 + 100,
                orbitSpeed: Math.random() * 0.02 + 0.001,
                angle: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: Math.random() * 0.02 - 0.01,
                type: 'planet'
            };
            planets.push(newPlanet);
            showNotification(`已添加 ${newPlanet.name}`);
        });
        
        // 添加小行星
        document.getElementById('addAsteroid').addEventListener('click', () => {
            const asteroid = {
                name: `小行星 ${planets.filter(p => p.type === 'asteroid').length + 1}`,
                radius: Math.random() * 3 + 1,
                color: '#8B7355',
                mass: Math.random() * 0.1 + 0.01,
                orbitRadius: Math.random() * 100 + 200,
                orbitSpeed: Math.random() * 0.01 + 0.005,
                angle: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: Math.random() * 0.05,
                type: 'asteroid'
            };
            planets.push(asteroid);
            showNotification(`已添加 ${asteroid.name}`);
        });
        
        // 添加彗星
        document.getElementById('addComet').addEventListener('click', () => {
            const comet = {
                name: `彗星 ${planets.filter(p => p.type === 'comet').length + 1}`,
                radius: Math.random() * 2 + 1,
                color: '#87CEEB',
                mass: Math.random() * 0.01 + 0.001,
                orbitRadius: Math.random() * 200 + 400,
                orbitSpeed: Math.random() * 0.005 + 0.001,
                angle: Math.random() * Math.PI * 2,
                rotation: 0,
                rotationSpeed: Math.random() * 0.1,
                type: 'comet',
                hasTail: true
            };
            planets.push(comet);
            showNotification(`已添加 ${comet.name}`);
        });
        
        // 引力相互作用
        document.getElementById('gravityInteraction').addEventListener('change', (e) => {
            gravityInteraction = e.target.checked;
            showNotification(gravityInteraction ? '引力相互作用已开启' : '引力相互作用已关闭');
        });
        
        // 加载双星系统
        document.getElementById('loadBinary').addEventListener('click', () => {
            if (confirm('这将替换当前系统，确定继续吗？')) {
                planets = [
                    {
                        name: '恒星 A',
                        radius: 25,
                        color: '#FFD700',
                        mass: 1000,
                        orbitRadius: 50,
                        orbitSpeed: 0.01,
                        angle: 0,
                        rotation: 0,
                        rotationSpeed: 0.02,
                        type: 'star'
                    },
                    {
                        name: '恒星 B',
                        radius: 20,
                        color: '#FF6347',
                        mass: 800,
                        orbitRadius: 50,
                        orbitSpeed: -0.01,
                        angle: Math.PI,
                        rotation: 0,
                        rotationSpeed: 0.015,
                        type: 'star'
                    },
                    {
                        name: '行星',
                        radius: 8,
                        color: '#4169E1',
                        mass: 5,
                        orbitRadius: 150,
                        orbitSpeed: 0.005,
                        angle: 0,
                        rotation: 0,
                        rotationSpeed: 0.01,
                        type: 'planet'
                    }
                ];
                showNotification('双星系统已加载');
            }
        });
        
        // 加载小行星带
        document.getElementById('loadAsteroidBelt').addEventListener('click', () => {
            if (confirm('这将替换当前系统，确定继续吗？')) {
                planets = [
                    {
                        name: '太阳',
                        radius: 30,
                        color: '#FDB813',
                        mass: 1989000,
                        orbitRadius: 0,
                        orbitSpeed: 0,
                        angle: 0,
                        rotation: 0,
                        rotationSpeed: 0.001,
                        type: 'star'
                    }
                ];
                
                // 添加小行星
                for (let i = 0; i < 50; i++) {
                    planets.push({
                        name: `小行星 ${i + 1}`,
                        radius: Math.random() * 2 + 0.5,
                        color: '#8B7355',
                        mass: Math.random() * 0.1 + 0.01,
                        orbitRadius: Math.random() * 50 + 200,
                        orbitSpeed: Math.random() * 0.005 + 0.002,
                        angle: Math.random() * Math.PI * 2,
                        rotation: 0,
                        rotationSpeed: Math.random() * 0.05,
                        type: 'asteroid'
                    });
                }
                
                showNotification('小行星带已加载');
            }
        });
        
        // 保存系统
        document.getElementById('saveSystem').addEventListener('click', () => {
            const systemData = {
                sun: sun,
                planets: planets,
                settings: {
                    scale: scale,
                    rotation: rotation,
                    speedMultiplier: speedMultiplier
                }
            };
            
            localStorage.setItem('solarSystem', JSON.stringify(systemData));
            showNotification('系统已保存到本地存储');
        });
        
        // 编辑行星
        document.getElementById('saveEdit').addEventListener('click', () => {
            if (selectedPlanet) {
                selectedPlanet.mass = parseFloat(document.getElementById('editMass').value);
                selectedPlanet.orbitRadius = parseFloat(document.getElementById('editRadius').value);
                selectedPlanet.orbitSpeed = parseFloat(document.getElementById('editSpeed').value);
                showPlanetInfo(selectedPlanet);
                showNotification('参数已更新');
            }
        });
        
        // 删除行星
        document.getElementById('deletePlanet').addEventListener('click', () => {
            if (selectedPlanet && confirm(`确定要删除 ${selectedPlanet.name} 吗？`)) {
                const index = planets.indexOf(selectedPlanet);
                if (index > -1) {
                    planets.splice(index, 1);
                    hidePlanetInfo();
                    showNotification(`${selectedPlanet.name} 已删除`);
                }
            }
        });
        
        // 窗口大小调整
        window.addEventListener('resize', () => {
            initCanvas();
        });
        
        // 初始化
        window.addEventListener('load', () => {
            initCanvas();
            
            // 隐藏加载画面
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 500);
            }, 1500);
            
            // 开始渲染
            render();
            
            // 尝试加载保存的系统
            const savedSystem = localStorage.getItem('solarSystem');
            if (savedSystem) {
                const data = JSON.parse(savedSystem);
                if (confirm('发现保存的系统，是否加载？')) {
                    planets = data.planets;
                    scale = data.settings.scale;
                    rotation = data.settings.rotation;
                    speedMultiplier = data.settings.speedMultiplier;
                    document.getElementById('zoomSlider').value = scale;
                    document.getElementById('zoomValue').textContent = Math.round(scale * 100) + '%';
                    document.getElementById('speedSlider').value = speedMultiplier;
                    document.getElementById('speedValue').textContent = speedMultiplier.toFixed(1) + 'x';
                    showNotification('已加载保存的系统');
                }
            }
        });
    </script>
</body>
</html>
