
代码
预览
￼
￼
￼
￼
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太阳系模拟器 - 完整轨道显示版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0
;
            padding: 0
;
            box-sizing
: border-box;
        }

        body
 {
            font-family: 'Arial'
, sans-serif;
            background: #000
;
            color: #fff
;
            overflow
: hidden;
            user-select: none;
        }

        #canvas
 {
            display
: block;
            cursor
: grab;
        }

        #canvas:active
 {
            cursor
: grabbing;
        }

        /* 侧边栏滚动条样式 */
        .sidebar
::-webkit-scrollbar {
            width: 8px
;
        }

        .sidebar
::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1
);
            border-radius: 4px
;
        }

        .sidebar
::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3
);
            border-radius: 4px
;
        }

        .sidebar
::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5
);
        }

        /* 控制面板样式 */
        .control-panel
 {
            background: rgba(0, 0, 0, 0.8
);
            backdrop-
filter: blur(10px
);
            border: 1px solid rgba(255, 255, 255, 0.1
);
        }

        /* 按钮样式 */
        .btn
 {
            transition: all 0.3s
 ease;
        }

        .btn:hover
 {
            transform: translateY(-2px
);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3
);
        }

        /* 输入框样式 */
        input[type="range"]
 {
            -webkit-appearance: none;
            appearance: none;
            background
: transparent;
            cursor
: pointer;
        }

        input[type="range"]
::-webkit-slider-track {
            background: rgba(255, 255, 255, 0.1
);
            height: 4px
;
            border-radius: 2px
;
        }

        input[type="range"]
::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            background: #3b82f6
;
            height: 16px
;
            width: 16px
;
            border-radius: 50%
;
            margin-top: -6px
;
        }

        /* 信息面板样式 */
        .info-panel
 {
            background: rgba(0, 0, 0, 0.8
);
            backdrop-
filter: blur(10px
);
            border: 1px solid rgba(255, 255, 255, 0.1
);
        }

        /* 轨道点样式 */
        .orbit-point
 {
            position
: absolute;
            width: 8px
;
            height: 8px
;
            border-radius: 50%
;
            transform: translate(-50%, -50%
);
        }

        .aphelion
 {
            background: #ef4444
;
            box-shadow: 0 0 10px #ef4444
;
        }

        .perihelion
 {
            background: #10b981
;
            box-shadow: 0 0 10px #10b981
;
        }

        /* 加载动画 */
        .loader
 {
            border: 3px solid rgba(255, 255, 255, 0.1
);
            border-radius: 50%
;
            border-top: 3px solid #3b82f6
;
            width: 40px
;
            height: 40px
;
            animation: spin 1s
 linear infinite;
        }

        @keyframes
 spin {
            0% { transform: rotate(0deg
); }
            100% { transform: rotate(360deg
); }
        }

        /* 提示框样式 */
        .tooltip
 {
            position
: absolute;
            background: rgba(0, 0, 0, 0.9
);
            color
: white;
            padding: 8px 12px
;
            border-radius: 4px
;
            font-size: 14px
;
            pointer-events
: none;
            z-index: 1000
;
            opacity: 0
;
            transition: opacity 0.3s
;
        }

        .tooltip.show
 {
            opacity: 1
;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <!-- 侧边栏控制面板 -->
    <div class="sidebar fixed left-0 top-0 h-full w-80 control-panel p-6 overflow-y-auto z-10">
        <h2 class="text-2xl font-bold mb-6 flex items-center">
            <i class="fas fa-satellite mr-3"></i>
            太阳系模拟器
        </h2>
        
        <!-- 模式选择 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">模拟模式</h3>
            <div class="flex space-x-2">
                <button id="realMode" class="btn flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                    真实模式
                </button>
                <button id="sandboxMode" class="btn flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded">
                    沙盒模式
                </button>
            </div>
        </div>
        
        <!-- 引力相互作用 -->
        <div class="mb-6">
            <label class="flex items-center cursor-pointer">
                <input type="checkbox" id="gravityToggle" class="mr-3">
                <span class="text-lg">启用引力相互作用</span>
            </label>
            <p class="text-sm text-gray-400 mt-2">开启后，天体之间会相互影响轨道</p>
        </div>
        
        <!-- 显示完整轨道 -->
        <div class="mb-6">
            <label class="flex items-center cursor-pointer">
                <input type="checkbox" id="showFullOrbit" class="mr-3" checked>
                <span class="text-lg">显示完整轨道</span>
            </label>
            <p class="text-sm text-gray-400 mt-2">显示远日点（红）和近日点（绿）</p>
        </div>
        
        <!-- 模拟速度 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">模拟速度</h3>
            <div class="flex items-center">
                <span class="text-sm mr-2">慢</span>
                <input type="range" id="speedSlider" min="0.1" max="10" step="0.1" value="1" class="flex-1">
                <span class="text-sm ml-2">快</span>
            </div>
            <div class="text-center mt-2">
                <span id="speedValue" class="text-blue-400">1.0x</span>
            </div>
        </div>
        
        <!-- 缩放控制 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">缩放控制</h3>
            <div class="flex items-center">
                <span class="text-sm mr-2">远</span>
                <input type="range" id="zoomSlider" min="0.1" max="5" step="0.1" value="1" class="flex-1">
                <span class="text-sm ml-2">近</span>
            </div>
            <div class="text-center mt-2">
                <span id="zoomValue" class="text-blue-400">1.0x</span>
            </div>
        </div>
        
        <!-- 轨迹长度 -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold mb-3">轨迹长度</h3>
            <div class="flex items-center">
                <span class="text-sm mr-2">短</span>
                <input type="range" id="trailSlider" min="10" max="500" step="10" value="100" class="flex-1">
                <span class="text-sm ml-2">长</span>
            </div>
            <div class="text-center mt-2">
                <span id="trailValue" class="text-blue-400">100</span>
            </div>
        </div>
        
        <!-- 沙盒模式控制 -->
        <div id="sandboxControls" class="hidden">
            <h3 class="text-lg font-semibold mb-3">添加天体</h3>
            
            <!-- 天体类型 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">天体类型</label>
                <select id="bodyType" class="w-full bg-gray-700 text-white py-2 px-3 rounded">
                    <option value="planet">行星</option>
                    <option value="moon">卫星</option>
                    <option value="asteroid">小行星</option>
                    <option value="comet">彗星</option>
                </select>
            </div>
            
            <!-- 天体名称 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">天体名称</label>
                <input type="text" id="bodyName" class="w-full bg-gray-700 text-white py-2 px-3 rounded" placeholder="输入名称">
            </div>
            
            <!-- 天体质量 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">质量 (地球质量倍数)</label>
                <input type="number" id="bodyMass" class="w-full bg-gray-700 text-white py-2 px-3 rounded" value="1" min="0.1" step="0.1">
            </div>
            
            <!-- 天体半径 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">半径 (地球半径倍数)</label>
                <input type="number" id="bodyRadius" class="w-full bg-gray-700 text-white py-2 px-3 rounded" value="1" min="0.1" step="0.1">
            </div>
            
            <!-- 轨道半径 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">轨道半径 (AU)</label>
                <input type="number" id="orbitRadius" class="w-full bg-gray-700 text-white py-2 px-3 rounded" value="1" min="0.1" step="0.1">
            </div>
            
            <!-- 轨道速度 -->
            <div class="mb-4">
                <label class="block text-sm mb-2">轨道速度 (km/s)</label>
                <input type="number" id="orbitSpeed" class="w-full bg-gray-700 text-white py-2 px-3 rounded" value="30" min="1" step="1">
            </div>
            
            <!-- 添加按钮 -->
            <button id="addBody" class="btn w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                <i class="fas fa-plus mr-2"></i>
添加天体
            </button>
            
            <!-- 清除所有 -->
            <button id="clearAll" class="btn w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded mt-3">
                <i class="fas fa-trash mr-2"></i>
清除所有
            </button>
        </div>
        
        <!-- 保存/加载 -->
        <div class="mt-6 pt-6 border-t border-gray-700">
            <h3 class="text-lg font-semibold mb-3">系统管理</h3>
            <button id="saveSystem" class="btn w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded mb-3">
                <i class="fas fa-save mr-2"></i>
保存当前系统
            </button>
            <button id="loadSystem" class="btn w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded">
                <i class="fas fa-folder-open mr-2"></i>
加载保存的系统
            </button>
        </div>
        
        <!-- 性能监控 -->
        <div class="mt-6 pt-6 border-t border-gray-700">
            <h3 class="text-lg font-semibold mb-3">性能监控</h3>
            <div class="flex justify-between">
                <span>FPS:</span>
                <span id="fps" class="text-green-400">60</span>
            </div>
            <div class="flex justify-between mt-2">
                <span>天体数量:</span>
                <span id="bodyCount" class="text-blue-400">8</span>
            </div>
        </div>
    </div>
    
    <!-- 信息面板 -->
    <div id="infoPanel" class="info-panel fixed right-4 top-4 p-4 rounded-lg hidden">
        <h3 class="text-lg font-semibold mb-2" id="infoTitle">天体信息</h3>
        <div id="infoContent" class="text-sm space-y-1">
            <!-- 动态内容 -->
        </div>
    </div>
    
    <!-- 提示框 -->
    <div id="tooltip" class="tooltip"></div>
    
    <!-- 加载提示 -->
    <div id="loadingScreen" class="fixed inset-0 bg-black flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <p class="text-xl">正在加载太阳系...</p>
        </div>
    </div>

    <script>
        // 全局变量
        const canvas = document.getElementById('canvas'
);
        const ctx = canvas.getContext('2d'
);
        const infoPanel = document.getElementById('infoPanel'
);
        const infoTitle = document.getElementById('infoTitle'
);
        const infoContent = document.getElementById('infoContent'
);
        const tooltip = document.getElementById('tooltip'
);
        const loadingScreen = document.getElementById('loadingScreen'
);
        
        // 设置画布大小
        function resizeCanvas(
) {
            canvas.
width = window.innerWidth
;
            canvas.
height = window.innerHeight
;
        }
        resizeCanvas
();
        window.addEventListener('resize'
, resizeCanvas);
        
        // 模拟参数
        let simulationSpeed = 1
;
        let zoom = 1
;
        let trailLength = 100
;
        let isPaused = false
;
        let isGravityEnabled = false
;
        let showFullOrbit = true
;
        let isSandboxMode = false
;
        let selectedBody = null
;
        
        // 相机参数
        let cameraX = 0
;
        let cameraY = 0
;
        let isDragging = false
;
        let dragStartX = 0
;
        let dragStartY = 0
;
        
        // 性能监控
        let fps = 60
;
        let lastTime = performance.now
();
        let frameCount = 0
;
        
        // 天体类
        class CelestialBody
 {
            constructor(name, mass, radius, color, x, y, vx, vy, isStar = false
) {
                this.name
 = name;
                this.mass
 = mass;
                this.radius
 = radius;
                this.color
 = color;
                this.x
 = x;
                this.y
 = y;
                this.vx
 = vx;
                this.vy
 = vy;
                this.isStar
 = isStar;
                this.trail
 = [];
                this.orbitPoints
 = [];
                this.aphelion = null
;
                this.perihelion = null
;
                this.orbitCenter = { x: 0, y: 0
 };
            }
            
            updatePosition(dt, bodies
) {
                if (this.isStar) return
;
                
                // 如果启用引力相互作用，计算所有天体的引力
                if
 (isGravityEnabled) {
                    let ax = 0, ay = 0
;
                    
                    for (let body of
 bodies) {
                        if (body === this) continue
;
                        
                        const dx = body.x - this.x
;
                        const dy = body.y - this.y
;
                        const distance = Math.sqrt
(dx * dx + dy * dy);
                        
                        if (distance > 0
) {
                            const force = G * body.mass
 / (distance * distance);
                            ax += force * dx / distance;
                            ay += force * dy / distance;
                        }
                    }
                    
                    this.vx
 += ax * dt;
                    this.vy
 += ay * dt;
                }
                
                this.x += this.vx
 * dt;
                this.y += this.vy
 * dt;
                
                // 更新轨迹
                this.trail.push({ x: this.x, y: this.y
 });
                if (this.trail.length >
 trailLength) {
                    this.trail.shift
();
                }
                
                // 更新轨道点
                this.orbitPoints.push({ x: this.x, y: this.y
 });
                if (this.orbitPoints.length > 1000
) {
                    this.orbitPoints.shift
();
                }
                
                // 计算远日点和近日点
                this.calculateOrbitExtremes
();
            }
            
            calculateOrbitExtremes(
) {
                if (this.orbitPoints.length < 10) return
;
                
                // 找到轨道中心（太阳位置）
                const sun = bodies.find(b => b.isStar
);
                if
 (sun) {
                    this.orbitCenter = { x: sun.x, y: sun.y
 };
                }
                
                let maxDist = 0
;
                let minDist = Infinity
;
                let aphelionPoint = null
;
                let perihelionPoint = null
;
                
                for (let point of this.orbitPoints
) {
                    const dx = point.x - this.orbitCenter.x
;
                    const dy = point.y - this.orbitCenter.y
;
                    const distance = Math.sqrt
(dx * dx + dy * dy);
                    
                    if (distance >
 maxDist) {
                        maxDist = distance;
                        aphelionPoint = point;
                    }
                    
                    if (distance <
 minDist) {
                        minDist = distance;
                        perihelionPoint = point;
                    }
                }
                
                this.aphelion
 = aphelionPoint;
                this.perihelion
 = perihelionPoint;
            }
            
            draw(ctx
) {
                // 绘制轨道
                if (this.trail.length > 1
) {
                    ctx.
beginPath
();
                    ctx.
moveTo
(
                        (
this.trail[0].x - cameraX) * zoom + canvas.width / 2
,
                        (
this.trail[0].y - cameraY) * zoom + canvas.height / 2
                    );
                    
                    for (let i = 1; i < this.trail.length
; i++) {
                        ctx.
lineTo
(
                            (
this.trail[i].x - cameraX) * zoom + canvas.width / 2
,
                            (
this.trail[i].y - cameraY) * zoom + canvas.height / 2
                        );
                    }
                    
                    ctx.
strokeStyle = this.color + '40'
;
                    ctx.
lineWidth = 1
;
                    ctx.
stroke
();
                }
                
                // 绘制完整轨道和极值点
                if (showFullOrbit && this.orbitPoints.length > 10
) {
                    // 绘制完整轨道
                    ctx.
beginPath
();
                    ctx.
moveTo
(
                        (
this.orbitPoints[0].x - cameraX) * zoom + canvas.width / 2
,
                        (
this.orbitPoints[0].y - cameraY) * zoom + canvas.height / 2
                    );
                    
                    for (let i = 1; i < this.orbitPoints.length
; i++) {
                        ctx.
lineTo
(
                            (
this.orbitPoints[i].x - cameraX) * zoom + canvas.width / 2
,
                            (
this.orbitPoints[i].y - cameraY) * zoom + canvas.height / 2
                        );
                    }
                    
                    ctx.
strokeStyle = this.color + '20'
;
                    ctx.
lineWidth = 1
;
                    ctx.
stroke
();
                    
                    // 绘制远日点
                    if (this.aphelion
) {
                        ctx.
beginPath
();
                        ctx.
arc
(
                            (
this.aphelion.x - cameraX) * zoom + canvas.width / 2
,
                            (
this.aphelion.y - cameraY) * zoom + canvas.height / 2
,
                            4
 * zoom,
                            0
,
                            Math.PI * 2
                        );
                        ctx.
fillStyle = '#ef4444'
;
                        ctx.
fill
();
                        
                        // 绘制远日点标签
                        ctx.
fillStyle = '#ef4444'
;
                        ctx.
font = '12px Arial'
;
                        ctx.
fillText
(
                            '远日点'
,
                            (
this.aphelion.x - cameraX) * zoom + canvas.width / 2 + 8
,
                            (
this.aphelion.y - cameraY) * zoom + canvas.height / 2 - 8
                        );
                    }
                    
                    // 绘制近日点
                    if (this.perihelion
) {
                        ctx.
beginPath
();
                        ctx.
arc
(
                            (
this.perihelion.x - cameraX) * zoom + canvas.width / 2
,
                            (
this.perihelion.y - cameraY) * zoom + canvas.height / 2
,
                            4
 * zoom,
                            0
,
                            Math.PI * 2
                        );
                        ctx.
fillStyle = '#10b981'
;
                        ctx.
fill
();
                        
                        // 绘制近日点标签
                        ctx.
fillStyle = '#10b981'
;
                        ctx.
font = '12px Arial'
;
                        ctx.
fillText
(
                            '近日点'
,
                            (
this.perihelion.x - cameraX) * zoom + canvas.width / 2 + 8
,
                            (
this.perihelion.y - cameraY) * zoom + canvas.height / 2 - 8
                        );
                    }
                }
                
                // 绘制天体
                const screenX = (this.x - cameraX) * zoom + canvas.width / 2
;
                const screenY = (this.y - cameraY) * zoom + canvas.height / 2
;
                const screenRadius = this.radius
 * zoom;
                
                // 绘制光晕效果（仅对恒星）
                if (this.isStar
) {
                    const gradient = ctx.createRadialGradient(screenX, screenY, 0, screenX, screenY, screenRadius * 3
);
                    gradient.
addColorStop(0, this.color
);
                    gradient.
addColorStop(0.3, this.color + '80'
);
                    gradient.
addColorStop(1, this.color + '00'
);
                    
                    ctx.
beginPath
();
                    ctx.
arc(screenX, screenY, screenRadius * 3, 0, Math.PI * 2
);
                    ctx.
fillStyle
 = gradient;
                    ctx.
fill
();
                }
                
                // 绘制天体本体
                ctx.
beginPath
();
                ctx.
arc(screenX, screenY, screenRadius, 0, Math.PI * 2
);
                ctx.
fillStyle = this.color
;
                ctx.
fill
();
                
                // 绘制选中效果
                if (selectedBody === this
) {
                    ctx.
beginPath
();
                    ctx.
arc(screenX, screenY, screenRadius + 5, 0, Math.PI * 2
);
                    ctx.
strokeStyle = '#ffffff'
;
                    ctx.
lineWidth = 2
;
                    ctx.
stroke
();
                }
                
                // 绘制标签
                ctx.
fillStyle = '#ffffff'
;
                ctx.
font = '14px Arial'
;
                ctx.
textAlign = 'center'
;
                ctx.
fillText(this.name, screenX, screenY + screenRadius + 20
);
            }
            
            isPointInside(x, y
) {
                const screenX = (this.x - cameraX) * zoom + canvas.width / 2
;
                const screenY = (this.y - cameraY) * zoom + canvas.height / 2
;
                const distance = Math.sqrt((x - screenX) ** 2 + (y - screenY) ** 2
);
                return distance <= this.radius * zoom + 5
;
            }
        }
        
        // 物理常数
        const G = 6.67430e-11; // 万有引力常数
        const AU = 1.496e11; // 天文单位（米）
        const EARTH_MASS = 5.972e24; // 地球质量（千克）
        const EARTH_RADIUS = 6.371e6; // 地球半径（米）
        
        // 创建太阳系
        const
 bodies = [
            // 太阳
            new CelestialBody
(
                '太阳'
,
                1.989e30
,
                20
,
                '#FDB813'
,
                0, 0, 0, 0
,
                true
            ),
            // 水星
            new CelestialBody
(
                '水星'
,
                3.301e23
,
                4
,
                '#8C7853'
,
                0.387 * AU, 0
,
                0, 47.87e3
            ),
            // 金星
            new CelestialBody
(
                '金星'
,
                4.867e24
,
                6
,
                '#FFC649'
,
                0.723 * AU, 0
,
                0, 35.02e3
            ),
            // 地球
            new CelestialBody
(
                '地球'
,
                5.972e24
,
                6
,
                '#4169E1'
,
                1.0 * AU, 0
,
                0, 29.78e3
            ),
            // 火星
            new CelestialBody
(
                '火星'
,
                6.417e23
,
                5
,
                '#CD5C5C'
,
                1.524 * AU, 0
,
                0, 24.07e3
            ),
            // 木星
            new CelestialBody
(
                '木星'
,
                1.898e27
,
                12
,
                '#DAA520'
,
                5.203 * AU, 0
,
                0, 13.07e3
            ),
            // 土星
            new CelestialBody
(
                '土星'
,
                5.683e26
,
                10
,
                '#F4A460'
,
                9.537 * AU, 0
,
                0, 9.69e3
            ),
            // 天王星
            new CelestialBody
(
                '天王星'
,
                8.681e25
,
                8
,
                '#4FD0E0'
,
                19.191 * AU, 0
,
                0, 6.81e3
            ),
            // 海王星
            new CelestialBody
(
                '海王星'
,
                1.024e26
,
                8
,
                '#4169E1'
,
                30.069 * AU, 0
,
                0, 5.43e3
            )
        ];
        
        // 更新天体数量显示
        function updateBodyCount(
) {
            document.getElementById('bodyCount').textContent = bodies.length
;
        }
        updateBodyCount
();
        
        // 鼠标事件处理
        canvas.
addEventListener('mousedown', (e) =>
 {
            const rect = canvas.getBoundingClientRect
();
            const x = e.clientX - rect.left
;
            const y = e.clientY - rect.top
;
            
            // 检查是否点击了天体
            for (let body of
 bodies) {
                if (body.isPointInside
(x, y)) {
                    selectedBody = body;
                    showInfoPanel
(body);
                    return
;
                }
            }
            
            // 如果没有点击天体，开始拖动
            isDragging = 
true
;
            dragStartX = e.
clientX
 - cameraX;
            dragStartY = e.
clientY
 - cameraY;
            canvas.
style.cursor = 'grabbing'
;
        });
        
        canvas.
addEventListener('mousemove', (e) =>
 {
            const rect = canvas.getBoundingClientRect
();
            const x = e.clientX - rect.left
;
            const y = e.clientY - rect.top
;
            
            if
 (isDragging) {
                cameraX = e.
clientX
 - dragStartX;
                cameraY = e.
clientY
 - dragStartY;
            } 
else
 {
                // 检查鼠标是否悬停在天体上
                let hoveringBody = null
;
                for (let body of
 bodies) {
                    if (body.isPointInside
(x, y)) {
                        hoveringBody = body;
                        break
;
                    }
                }
                
                if
 (hoveringBody) {
                    canvas.
style.cursor = 'pointer'
;
                    showTooltip(e.clientX, e.clientY, hoveringBody.name
);
                } 
else
 {
                    canvas.
style.cursor = 'grab'
;
                    hideTooltip
();
                }
            }
        });
        
        canvas.
addEventListener('mouseup', () =>
 {
            isDragging = 
false
;
            canvas.
style.cursor = 'grab'
;
        });
        
        canvas.
addEventListener('wheel', (e) =>
 {
            e.
preventDefault
();
            const delta = e.deltaY > 0 ? 0.9 : 1.1
;
            zoom *= delta;
            zoom = 
Math.max(0.1, Math.min(5
, zoom));
            document.getElementById('zoomSlider').value
 = zoom;
            document.getElementById('zoomValue').textContent = zoom.toFixed(1) + 'x'
;
        });
        
        // 显示信息面板
        function showInfoPanel(body
) {
            infoPanel.
classList.remove('hidden'
);
            infoTitle.
textContent = body.name
;
            
            let content = 
`
                <div>质量: ${(body.mass / EARTH_MASS).toFixed(2)} 地球质量</div>
                <div>半径: ${(body.radius / 1e6).toFixed(0)} km</div>
                <div>位置: (${(body.x / AU).toFixed(2)},${(body.y / AU).toFixed(2)}) AU</div>
                <div>速度: ${Math.sqrt(body.vx ** 2 + body.vy ** 2) / 1000} km/s</div>
            `
;
            
            if (body.aphelion
) {
                const aphelionDist = Math.sqrt
(
                    (body.
aphelion.x - body.orbitCenter.x) ** 2
 + 
                    (body.
aphelion.y - body.orbitCenter.y) ** 2
                ) / 
AU
;
                content += 
`<div>远日点: ${aphelionDist.toFixed(2)} AU</div>`
;
            }
            
            if (body.perihelion
) {
                const perihelionDist = Math.sqrt
(
                    (body.
perihelion.x - body.orbitCenter.x) ** 2
 + 
                    (body.
perihelion.y - body.orbitCenter.y) ** 2
                ) / 
AU
;
                content += 
`<div>近日点: ${perihelionDist.toFixed(2)} AU</div>`
;
            }
            
            infoContent.
innerHTML
 = content;
        }
        
        // 显示提示框
        function showTooltip(x, y, text
) {
            tooltip.
textContent
 = text;
            tooltip.
style.left = x + 10 + 'px'
;
            tooltip.
style.top = y - 30 + 'px'
;
            tooltip.
classList.add('show'
);
        }
        
        // 隐藏提示框
        function hideTooltip(
) {
            tooltip.
classList.remove('show'
);
        }
        
        // 控制面板事件处理
        document.getElementById('realMode').addEventListener('click', () =>
 {
            isSandboxMode = 
false
;
            document.getElementById('realMode').classList.add('bg-blue-600'
);
            document.getElementById('realMode').classList.remove('bg-gray-600'
);
            document.getElementById('sandboxMode').classList.add('bg-gray-600'
);
            document.getElementById('sandboxMode').classList.remove('bg-blue-600'
);
            document.getElementById('sandboxControls').classList.add('hidden'
);
        });
        
        document.getElementById('sandboxMode').addEventListener('click', () =>
 {
            isSandboxMode = 
true
;
            document.getElementById('sandboxMode').classList.add('bg-blue-600'
);
            document.getElementById('sandboxMode').classList.remove('bg-gray-600'
);
            document.getElementById('realMode').classList.add('bg-gray-600'
);
            document.getElementById('realMode').classList.remove('bg-blue-600'
);
            document.getElementById('sandboxControls').classList.remove('hidden'
);
        });
        
        document.getElementById('gravityToggle').addEventListener('change', (e) =>
 {
            isGravityEnabled = e.
target.checked
;
        });
        
        document.getElementById('showFullOrbit').addEventListener('change', (e) =>
 {
            showFullOrbit = e.
target.checked
;
        });
        
        document.getElementById('speedSlider').addEventListener('input', (e) =>
 {
            simulationSpeed = 
parseFloat(e.target.value
);
            document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'x'
;
        });
        
        document.getElementById('zoomSlider').addEventListener('input', (e) =>
 {
            zoom = 
parseFloat(e.target.value
);
            document.getElementById('zoomValue').textContent = zoom.toFixed(1) + 'x'
;
        });
        
        document.getElementById('trailSlider').addEventListener('input', (e) =>
 {
            trailLength = 
parseInt(e.target.value
);
            document.getElementById('trailValue').textContent
 = trailLength;
        });
        
        // 添加天体
        document.getElementById('addBody').addEventListener('click', () =>
 {
            const type = document.getElementById('bodyType').value
;
            const name = document.getElementById('bodyName').value || '新天体'
;
            const mass = parseFloat(document.getElementById('bodyMass').value) * EARTH_MASS
;
            const radius = parseFloat(document.getElementById('bodyRadius').value) * 1e6
;
            const orbitRadius = parseFloat(document.getElementById('orbitRadius').value) * AU
;
            const orbitSpeed = parseFloat(document.getElementById('orbitSpeed').value) * 1000
;
            
            // 随机角度
            const angle = Math.random() * Math.PI * 2
;
            const x = orbitRadius * Math.cos
(angle);
            const y = orbitRadius * Math.sin
(angle);
            
            // 垂直于径向的速度
            const vx = -orbitSpeed * Math.sin
(angle);
            const vy = orbitSpeed * Math.cos
(angle);
            
            // 根据类型设置颜色
            let
 color;
            switch
 (type) {
                case 'planet'
:
                    color = 
'#4169E1'
;
                    break
;
                case 'moon'
:
                    color = 
'#C0C0C0'
;
                    break
;
                case 'asteroid'
:
                    color = 
'#8B4513'
;
                    break
;
                case 'comet'
:
                    color = 
'#00FFFF'
;
                    break
;
                default
:
                    color = 
'#FFFFFF'
;
            }
            
            const newBody = new CelestialBody
(name, mass, radius, color, x, y, vx, vy);
            bodies.
push
(newBody);
            updateBodyCount
();
            
            // 清空输入
            document.getElementById('bodyName').value = ''
;
        });
        
        // 清除所有天体
        document.getElementById('clearAll').addEventListener('click', () =>
 {
            if (confirm('确定要清除所有自定义天体吗？'
)) {
                // 保留太阳和原始行星
                const originalBodies = bodies.slice(0, 9
);
                bodies.
length = 0
;
                bodies.
push
(...originalBodies);
                updateBodyCount
();
            }
        });
        
        // 保存系统
        document.getElementById('saveSystem').addEventListener('click', () =>
 {
            const
 systemData = {
                bodies: bodies.map(body =>
 ({
                    name: body.name
,
                    mass: body.mass
,
                    radius: body.radius
,
                    color: body.color
,
                    x: body.x
,
                    y: body.y
,
                    vx: body.vx
,
                    vy: body.vy
,
                    isStar: body.isStar
                })),
                settings
: {
                    simulationSpeed,
                    zoom,
                    trailLength,
                    isGravityEnabled,
                    showFullOrbit
                }
            };
            
            localStorage.setItem('solarSystem', JSON.stringify
(systemData));
            alert('系统已保存！'
);
        });
        
        // 加载系统
        document.getElementById('loadSystem').addEventListener('click', () =>
 {
            const savedData = localStorage.getItem('solarSystem'
);
            if
 (savedData) {
                const systemData = JSON.parse
(savedData);
                
                // 清空现有天体
                bodies.
length = 0
;
                
                // 加载天体
                for (let bodyData of systemData.bodies
) {
                    const body = new CelestialBody
(
                        bodyData.
name
,
                        bodyData.
mass
,
                        bodyData.
radius
,
                        bodyData.
color
,
                        bodyData.
x
,
                        bodyData.
y
,
                        bodyData.
vx
,
                        bodyData.
vy
,
                        bodyData.
isStar
                    );
                    bodies.
push
(body);
                }
                
                // 加载设置
                const settings = systemData.settings
;
                simulationSpeed = settings.
simulationSpeed
;
                zoom = settings.
zoom
;
                trailLength = settings.
trailLength
;
                isGravityEnabled = settings.
isGravityEnabled
;
                showFullOrbit = settings.
showFullOrbit
;
                
                // 更新UI
                document.getElementById('speedSlider').value
 = simulationSpeed;
                document.getElementById('speedValue').textContent = simulationSpeed.toFixed(1) + 'x'
;
                document.getElementById('zoomSlider').value
 = zoom;
                document.getElementById('zoomValue').textContent = zoom.toFixed(1) + 'x'
;
                document.getElementById('trailSlider').value
 = trailLength;
                document.getElementById('trailValue').textContent
 = trailLength;
                document.getElementById('gravityToggle').checked
 = isGravityEnabled;
                document.getElementById('showFullOrbit').checked
 = showFullOrbit;
                
                updateBodyCount
();
                alert('系统已加载！'
);
            } 
else
 {
                alert('没有找到保存的系统！'
);
            }
        });
        
        // 键盘事件
        document.addEventListener('keydown', (e) =>
 {
            switch (e.key
) {
                case ' '
:
                    e.
preventDefault
();
                    isPaused = !isPaused;
                    break
;
                case 'Delete'
:
                    if (selectedBody && !selectedBody.isStar &&
 isSandboxMode) {
                        const index = bodies.indexOf
(selectedBody);
                        if (index > -1
) {
                            bodies.
splice(index, 1
);
                            selectedBody = 
null
;
                            infoPanel.
classList.add('hidden'
);
                            updateBodyCount
();
                        }
                    }
                    break
;
            }
        });
        
        // 动画循环
        function animate(currentTime
) {
            requestAnimationFrame
(animate);
            
            // 计算FPS
            frameCount++;
            if (currentTime - lastTime >= 1000
) {
                fps = frameCount;
                frameCount = 
0
;
                lastTime = currentTime;
                document.getElementById('fps').textContent
 = fps;
            }
            
            // 清空画布
            ctx.
fillStyle = 'rgba(0, 0, 0, 0.1)'
;
            ctx.
fillRect(0, 0, canvas.width, canvas.height
);
            
            // 绘制背景星星
            if (frameCount % 60 === 0
) {
                for (let i = 0; i < 100
; i++) {
                    const x = Math.random() * canvas.width
;
                    const y = Math.random() * canvas.height
;
                    const size = Math.random() * 2
;
                    const opacity = Math.random() * 0.8 + 0.2
;
                    
                    ctx.
beginPath
();
                    ctx.
arc(x, y, size, 0, Math.PI * 2
);
                    ctx.
fillStyle = `rgba(255, 255, 255, ${opacity})`
;
                    ctx.
fill
();
                }
            }
            
            // 更新和绘制天体
            if
 (!isPaused) {
                const dt = 86400 * simulationSpeed; // 一天的秒数
                
                for (let body of
 bodies) {
                    body.
updatePosition
(dt, bodies);
                }
            }
            
            for (let body of
 bodies) {
                body.
draw
(ctx);
            }
            
            // 隐藏加载屏幕
            if (loadingScreen.style.display !== 'none'
) {
                loadingScreen.
style.display = 'none'
;
            }
        }
        
        // 启动动画
        animate(0
);
    </script>
</body>
</html>
